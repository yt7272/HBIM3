# 插件快速测试清单 (版本 0.2.13.71)

本清单用于快速验证插件核心功能是否正常工作。所有已知问题已修复。

## 测试前准备
- [ ] ArchiCAD 29 已启动
- [ ] 插件已安装: `~/Library/Application Support/GRAPHISOFT/ARCHICAD 29/Add-Ons/MergedPlugin.bundle`
- [ ] 插件管理器已启用 "NewPlugin"
- [ ] 通过菜单 **测试 → NewPlugin** 打开插件面板

## 核心功能验证

### 1. 版本显示 ✅
- [ ] 插件面板右上角显示版本号 **"V0.2.13.71"**
- [ ] 版本号与实际构建版本一致

### 2. 构件选择响应 ✅
- [ ] 在 ArchiCAD 中选择任意构件 (墙、门、窗等)
- [ ] 插件面板应在 **1秒内** 更新显示构件信息
- [ ] 构件信息组显示构件 GUID 和类型
- [ ] **构件信息** 组显示 **"编辑信息"** 或 **"添加信息"** 按钮 (可操作)

### 3. 构件信息编辑工作流 ✅
- [ ] 点击 **"编辑信息"** 按钮
- [ ] 输入框变为可编辑状态 (构件编号、照片说明)
- [ ] 填写测试数据:
  - 构件编号: `TEST-001`
  - 照片说明: `测试构件`
- [ ] 点击 **"保存"** 按钮
- [ ] 返回查看模式，显示已保存的数据
- [ ] 选择其他构件后再返回原构件，数据应保持不变

### 4. 照片功能 (需要GlobalId) ✅
- [ ] 选择 **有GlobalId属性** 的构件 (IFC兼容构件)
- [ ] **"选择照片"** 按钮应启用 (未禁用)
- [ ] 点击 **"选择照片"** 按钮，选择1-2张测试图片
- [ ] 照片预览区域显示缩略图和导航按钮
- [ ] 使用左右箭头切换照片
- [ ] 点击 **"查看照片"** 按钮应在默认查看器中打开照片

### 5. GlobalId防护栏验证 ✅
- [ ] 选择 **没有GlobalId属性** 的构件 (普通Archicad元素)
- [ ] **"选择照片"** 按钮应禁用 (灰色不可点击)
- [ ] **"查看照片"** 按钮应禁用 (如果没有照片)
- [ ] 符合防护栏要求: **NO fallback to GUID**

### 6. IFC属性显示 ✅
- [ ] 选择 **IFC兼容** 构件
- [ ] IFC属性组显示属性表格 (属性集、属性名、值、类型、单位)
- [ ] 支持搜索过滤 (在搜索框输入关键词)
- [ ] 属性组可展开/折叠

### 7. 编辑模式保护 ✅
- [ ] 进入编辑模式后，尝试选择其他构件
- [ ] 插件应自动退出编辑模式，丢弃未保存更改
- [ ] 显示新选择的构件信息

### 8. 未保存更改指示器 ✅
- [ ] 在编辑模式下修改任何字段
- [ ] 构件信息标题旁应显示 **"*"** 星号指示器
- [ ] 保存后星号消失
- [ ] 取消编辑后星号消失

## 浏览器控制台验证 (F12)

### 9. JavaScript桥接函数 ✅
```javascript
// 执行以下命令，全部应成功:
console.log("ACAPI对象:", typeof ACAPI !== 'undefined');
console.log("ACAPI函数:", Object.keys(ACAPI || {}));

const version = await ACAPI.GetPluginVersion();
console.log("插件版本:", version); // 应为 "0.2.13.71"

const elements = await ACAPI.GetSelectedElements();
console.log("当前选中构件:", elements);

// 如果有选中构件
if (elements && elements.length > 0) {
  const info = await ACAPI.ComponentInfo_GetComponentInfo(elements[0]);
  console.log("构件信息 (5元素数组):", info); // [组件编号, 照片说明, 照片路径数组, GlobalId, 文件夹名]
}
```

### 10. 错误检查 ✅
- [ ] 控制台无JavaScript错误 (红色错误信息)
- [ ] 无网络资源加载失败
- [ ] ACAPI所有函数调用正常

## 日志文件检查

### 11. 插件日志 ✅
```bash
# 检查插件日志文件
tail -20 ~/Library/Logs/NewPlugin.log
```
- [ ] 日志文件存在且可读
- [ ] 无严重错误记录 (如崩溃、API调用失败)

## 测试完成标准

- [ ] 所有上述检查项通过
- [ ] 插件功能完整，无阻塞性问题
- [ ] 符合防护栏要求 (无缓存、无GUID回退、无独立模态窗口)

## 已知限制 (符合防护栏要求)

1. **无缓存系统**: IFC属性每次读取都会查询IFC API，无性能优化
2. **无GUID回退**: 照片功能严格需要GlobalId，无备用方案
3. **最小错误处理**: 基础错误处理，无过度工程化
4. **单一界面**: 所有功能在单一HTML界面中，无独立窗口

## 问题报告

如果测试失败，请收集以下信息:
1. ArchiCAD版本号
2. 插件版本号 (面板显示)
3. 浏览器控制台错误截图
4. `~/Library/Logs/NewPlugin.log` 文件内容
5. 详细的重现步骤

---

**最后更新**: 2026-02-13  
**插件版本**: 0.2.13.71  
**状态**: 等待用户测试验证