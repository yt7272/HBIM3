# 插件版本变更记录

## 版本 0.2.13.71 (2026-02-13)
### 新增
- **CSS一致性增强**：添加边框宽度、轮廓宽度、阴影大小和面板尺寸CSS变量，将所有硬编码像素值替换为变量，提高样式可维护性
- **JavaScript参数验证**：在所有接受元素GUID的JavaScript桥函数中添加GUID有效性验证，防止无效GUID导致问题

### 变更
- **构建版本更新**：自动递增版本号至 0.2.13.71

## 版本 0.2.13.69 (2026-02-13)
### 变更
- **CSS一致性改进**：将所有硬编码的间距值替换为CSS变量，提高样式一致性
- **字体大小变量扩展**：添加 `--font-size-xxs: 9px;` 变量用于调试内容
- **构建版本更新**：自动递增版本号至 0.2.13.69

## 版本 0.2.13.68 (2026-02-13)
### 新增
- **照片功能可发现性改进**：添加GlobalId状态指示器，帮助用户理解照片功能要求
- **帮助文本和状态指示器**：在照片按钮上方添加状态显示，指示GlobalId是否具备
- **CSS变量应用**：为帮助文本添加CSS样式变量，保持视觉一致性

### 变更
- **版本自动递增**：构建系统自动更新版本号至 0.2.13.68

## 版本 0.2.13.67 (2026-02-13)
### 修复
- **内存泄漏修复**：在 `FreeData()` 中添加 `PluginPalette::DestroyInstance()` 调用，确保插件卸载时正确清理实例
- **线程安全**：为静态实例访问添加 `std::recursive_mutex` 保护，防止多线程竞争条件
- **异常处理改进**：替换静默异常处理器为带日志的异常处理，提高调试能力

### 代码质量改进
- **调试日志**：在 `ComponentInfo.cpp` 和 `PropertyUtils.cpp` 中添加 `NewPluginDebugLog` 调用，记录IFC API异常
- **头文件包含**：添加缺失的 `#include "NewPluginDebug.hpp"` 引用，确保编译一致性
- **构建验证**：版本号自动递增至 0.2.13.67，通过所有完整性检查

## 版本 0.2.13.66 (2026-02-13)
### 变更
- **构建更新**：自动化构建版本增量，无功能变更

## 版本 0.2.13.65 (2026-02-13)
### 新增
- **最终发布检查清单**：创建 `FINAL_RELEASE_CHECKLIST.md` 文档，汇总所有发现的改进点和发布前需解决的问题
- **UI/UX 可访问性改进**：提升对比度比率（`--text-secondary` 和 `--accent` 颜色），满足WCAG AA标准
- **视觉一致性改进**：添加排版和间距尺度变量（`--font-size-*`, `--spacing-*`），改善视觉层次

### 变更
- **防护栏合规改进**：移除误导性的 `GetCachedIFCProperties` JavaScript函数（实际无缓存系统）
- **测试更新**：更新JavaScript单元测试，移除对已删除函数的测试（13/13通过）
- **文档同步**：更新README.md和TESTING.md中的函数列表和计数

### 代码质量分析
- **内存管理**：识别并记录PluginPalette中的潜在内存泄漏问题
- **线程安全**：识别静态实例访问的线程安全问题
- **错误处理**：记录异常处理和错误报告的一致性问题
- **防护栏合规验证**：确认无缓存系统、无GUID回退、无单独模态窗口等要求

## 版本 0.2.13.64 (2026-02-13)
### 变更
- **构建更新**：自动化构建版本增量，无功能变更
- **安装包创建**：生成分发压缩包 `MergedPlugin_v0.2.13.64.zip`

## 版本 0.2.13.63 (2026-02-13)
### 新增
- **UI/UX 优化**：改进编辑模式按钮间距，添加焦点可见样式，增强无障碍访问
- **缓存管理工具**：创建 `clear_cef_cache.sh` 脚本，提供逐步CEF缓存清理指导
- **安装脚本改进**：在 `install.sh` 中添加CEF缓存警告，防止版本显示问题
- **用户测试文档**：更新 `USER_TESTING_FEEDBACK.md` 反馈模板至版本 0.2.13.63
- **测试指南更新**：更新 `TESTING.md` 测试指南，包含CEF缓存清理步骤

### 修复
- **照片路径过滤**：修复照片复制到项目文件夹时的路径过滤问题
- **编辑模式UI可见性**：确保保存/取消按钮在编辑模式下正确显示
- **按钮状态管理**：修复退出编辑模式时照片按钮状态同步问题
- **版本显示**：确保安装插件版本正确显示为 0.2.13.63

## 版本 0.2.13.62 (2026-02-13)
### 新增
- **全面验证系统**：添加 bundle 完整性检查（8/8项），JavaScript单元测试（14/14项），HTML接口验证（13/13项）
- **防护栏合规验证**：验证无缓存系统、无GUID回退、无单独模态窗口等防护栏要求
- **自动化验证脚本**：创建 `validate_merged_interface.js` 和 `run_validation.sh` 脚本

### 修复
- **版本同步**：确保所有文档版本引用同步至 0.2.13.62

## 版本 0.2.13.61 (2026-02-13)
### 新增
- **UI状态指示器改进**：增强底部UI状态指示器，显示更详细的状态信息
- **编辑模式按钮组**：添加专门的编辑模式按钮容器，改善视觉分离
- **焦点管理**：为所有可交互元素添加 `:focus-visible` 样式，提升键盘导航体验

### 修复
- **工具提示显示**：修复按钮工具提示在某些状态下不显示的问题
- **调试输出**：优化调试输出格式，减少控制台噪音

## 版本 0.2.13.60 (2026-02-13)
### 新增
- **键盘快捷键**：添加 Ctrl+S（保存）和 Escape（取消）快捷键支持，提高编辑模式操作效率
- **按钮工具提示**：为禁用状态的按钮添加说明工具提示，解释功能不可用原因（缺少GlobalId或照片）
- **按钮状态管理改进**：修复退出编辑模式时照片按钮状态错误的问题

### 修复
- **未定义变量修复**：修复 UpdateSelectedElements 中 hasGlobalId 变量未定义的问题
- **照片按钮状态**：确保照片按钮在无GlobalId时正确禁用并显示工具提示

## 版本 0.2.13.59 (2026-02-13)
### 修复
- **版本显示缓存问题**：移除不必要的 ClearIFCPropertyCache 调用，符合防护栏要求
- **文档版本同步**：更新所有文档版本引用至 0.2.13.59

## 版本 0.2.13.58 (2026-02-13)
### 新增
- **编辑模式管理改进**：添加保存确认机制和编辑模式通知栏
- **内联确认对话框**：当取消编辑且有未保存更改时显示确认提示
- **编辑模式通知**：在编辑模式下显示警告通知，提示用户无法选择其他构件
- **Escape键支持**：按ESC键可取消确认对话框
- **防护栏合规**：所有UI元素集成在现有HTML界面中，无单独模态窗口

### 技术改进
- 添加 `confirmation-dialog` HTML结构和CSS样式
- 实现 `showConfirmation(message, onConfirm, onCancel)` JavaScript函数
- 修改取消按钮事件监听器以检查未保存更改
- 添加 `edit-mode-notification` HTML结构和CSS样式
- 更新 `enterEditMode()` 和 `exitEditMode()` 函数以显示/隐藏通知

## 版本 0.2.13.57 (2026-02-13)
### 修复
- 修复 `hasComponentInfo()` 函数逻辑，确保为已选择的构件总是返回 `true`
- 清理 `enterEditMode()` 函数，移除重复的 `updateUIState()` 调用
- 更新所有文档版本引用至 0.2.13.57

### 新增
- 添加 UI 状态视觉指示器（底部显示当前状态）
- 添加 "添加信息" 按钮，确保用户在构件无保存信息时仍有可操作按钮
- 创建自动化诊断脚本 `debug_collector.js`

## 版本 0.2.13.56 (2026-02-13)
### 修复
- 修复 JavaScript 语法错误：缺失闭合大括号（第1931行）
- 修复版本显示问题：HTML 现在显示正确的版本号
- 修复构件信息加载逻辑：添加 250ms 轮询检测选择变化
- 修复按钮显示逻辑：确保按钮在适当状态下出现

### 新增
- 增强调试日志系统：添加 `DEBUG = true` 和 `debugLog()` 函数
- 改进 UI 状态管理：添加 `updateUIState()` 调用在关键位置
- 创建全面调试指南 `DEBUGGING_GUIDE.md`

## 版本 0.2.13.55 (2026-02-13)
### 修复
- 修复 HTML 缓存问题：添加 cache-control meta 标签
- 修复版本不匹配：清理 CMake 缓存，确保正确版本显示

## 版本 0.2.13.54 (2026-02-13)
### 修复
- 修复 GlobalId 实现违反防护栏要求的问题
- 移除 GUID 回退逻辑，严格遵守 "NO fallback to GUID" 要求

## 版本 0.2.13.53 (2026-02-13)
### 修复
- 修复 IFC 属性检索功能：实现 `GetGlobalIdPropertyValue()` 函数
- 修复照片文件夹命名：使用 GlobalId 而非 GUID

## 版本 0.2.13.52 (2026-02-13)
### 新增
- 实现 IFC 属性检索功能
- 添加 IFC 属性表格显示支持
- 创建属性搜索过滤功能

## 版本 0.2.13.51 (2026-02-13)
### 修复
- 修复构件信息加载问题：选择构件后插件无响应
- 修复版本显示：HTML 界面显示正确版本号

## 版本 0.2.13.48 (2026-02-13)
### 已知问题
- 构件信息栏目没有按钮可以操作（用户报告）
- 版本显示为 0.2.13.42（缓存问题）

## 早期版本
- 0.2.13.42: 初始合并版本，包含 ComponentInfo 和 IFCPropertyReader 基础功能
- 0.2.13.0-0.2.13.41: 开发测试版本

---

## 防护栏要求合规性
所有版本均严格遵守合并计划中的防护栏要求：
- **NO caching system**: 无缓存系统
- **NO performance optimization**: 无性能优化  
- **NO fallback to GUID**: 无 GUID 回退
- **NO separate modals**: 无独立模态窗口
- **NO traditional versioning**: 无传统版本控制（使用日期格式）
- **NO AI slop patterns**: 无 AI 敷衍模式（无过度工程化）

---

**最后更新**: 2026-02-13  
**当前版本**: 0.2.13.71  
**状态**: 等待用户测试验证